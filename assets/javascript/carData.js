const carMarket = {
  sellers: [
    {
      agencyName: "Best Deal",
      cash: 1245000,
      credit: 200000,
      agencyId: "Plyq5M5AZ",

      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "3",
              year: 2015,
              price: 137000,
              carNumber: "AZJZ4",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "X6",
              year: 2020,
              price: 966500,
              carNumber: "S6DL1",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2020,
              price: 336300,
              carNumber: "6rvXw",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Hilux",
              year: 2005,
              price: 35005,
              carNumber: "MWXBG",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Corolla",
              year: 2020,
              price: 111900,
              carNumber: "hCzl-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Focus",
              year: 2020,
              price: 98200,
              carNumber: "kN3HP",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Focus",
              year: 2005,
              price: 6502,
              carNumber: "LJTCs",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Romeo Julia",
              year: 2020,
              price: 275406,
              carNumber: "2kjy7",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Romeo Stelvio",
              year: 2019,
              price: 215403,
              carNumber: "7A5b-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Traverse",
              year: 2020,
              price: 201102,
              carNumber: "QwBOT",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Impala",
              year: 2019,
              price: 165041,
              carNumber: "2v4jt",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Malibu",
              year: 2017,
              price: 75405,
              carNumber: "O4_Jv",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
      ],
    },
    {
      agencyName: "CarMax",
      cash: 968541,
      credit: 500000,
      agencyId: "26_IPfHU1",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X5",
              year: 2015,
              price: 218000,
              carNumber: "4Ixb0",
              ownerId: "26_IPfHU1",
            },
            {
              name: "X6",
              year: 2014,
              price: 97100,
              carNumber: "kAnv-",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Z4",
              year: 2019,
              price: 296900,
              carNumber: "ISMdU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "3",
              year: 2010,
              price: 75100,
              carNumber: "9DJPw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2005,
              price: 80540,
              carNumber: "Kt-pW",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Corolla",
              year: 2019,
              price: 109100,
              carNumber: "YiYdI",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Hilux",
              year: 2019,
              price: 204000,
              carNumber: "DRmNw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "F250",
              year: 2020,
              price: 198500,
              carNumber: "g4Wfp",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Explorer",
              year: 2020,
              price: 265200,
              carNumber: "iNT8Q",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Spider",
              year: 2011,
              price: 75405,
              carNumber: "6t7QU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "166",
              year: 2002,
              price: 12400,
              carNumber: "XMqpn",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2016,
              price: 65042,
              carNumber: "vbeAo",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Savannah",
              year: 2016,
              price: 76505,
              carNumber: "WelWa",
              ownerId: "26_IPfHU1",
            },
          ],
        },
      ],
    },
    {
      agencyName: "The Auto World",
      cash: 687450,
      credit: 200000,
      agencyId: "gNHjNFL12",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X6",
              year: 2018,
              price: 548100,
              carNumber: "EMW_7",
              ownerId: "gNHjNFL12",
            },
            {
              name: "3",
              year: 2017,
              price: 178000,
              carNumber: "XlnB4",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2017,
              price: 101542,
              carNumber: "-RQgN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Highlander",
              year: 2017,
              price: 202540,
              carNumber: "AZJZ4",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 1996,
              price: 5420,
              carNumber: "kHE8f",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 2012,
              price: 40570,
              carNumber: "p2qEi",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Explorer",
              year: 2014,
              price: 127502,
              carNumber: "Ty1zN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "F350",
              year: 2012,
              price: 54250,
              carNumber: "z03H2",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Savannah",
              year: 2010,
              price: 36504,
              carNumber: "RXFZe",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Malibu",
              year: 2009,
              price: 19585,
              carNumber: "K5IsM",
              ownerId: "gNHjNFL12",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Car Werks",
      cash: 302502,
      credit: 150000,
      agencyId: "9KeaYbRLP",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "8",
              year: 2020,
              price: 942500,
              carNumber: "4IUMz",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X6",
              year: 2010,
              price: 129000,
              carNumber: "Vw0fV",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X3",
              year: 2019,
              price: 358100,
              carNumber: "ufN54",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2020,
              price: 389100,
              carNumber: "F127X",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2002,
              price: 18400,
              carNumber: "ueZUp",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2011,
              price: 38520,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Land Cruiser",
              year: 2019,
              price: 290040,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2020,
              price: 215700,
              carNumber: "xig8N",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2015,
              price: 178506,
              carNumber: "ghTiQ",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Corolla",
              year: 2002,
              price: 8504,
              carNumber: "Mvw8T",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2005,
              price: 9320,
              carNumber: "BZpkt",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Malibu",
              year: 2002,
              price: 4502,
              carNumber: "KqKV_",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Carsova",
      cash: 72450,
      credit: 50000,
      agencyId: "oqQmsZoUo",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "7",
              year: 1999,
              price: 24700,
              carNumber: "sZrjp",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "3",
              year: 2008,
              price: 54000,
              carNumber: "da88K",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2019,
              price: 124050,
              carNumber: "ZfbqH",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "Hilux",
              year: 1996,
              price: 11540,
              carNumber: "AZJZ4",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
      ],
    },
  ],
  customers: [
    {
      name: "Lilah Goulding",
      id: "BGzHhjnE8",
      cars: [
        {
          name: "Corolla",
          year: 2013,
          price: 40570,
          carNumber: "16da1",
          ownerId: "BGzHhjnE8",
        },
      ],
      cash: 35000,
    },
    {
      name: "Ravi Murillo",
      id: "2RprZ1dbL",
      cars: [
        {
          name: "M5",
          year: 2019,
          price: 578054,
          carNumber: "WIh0U",
          ownerId: "2RprZ1dbL",
        },
        {
          name: "Spider",
          year: 2012,
          price: 81520,
          carNumber: "RLS4q",
          ownerId: "2RprZ1dbL",
        },
      ],
      cash: 278542,
    },
    {
      name: "Aleksander Carr",
      id: "pAuFtn_WA",
      cars: [
        {
          name: "Highlander",
          year: 2018,
          price: 214503,
          carNumber: "2WU_y",
          ownerId: "pAuFtn_WA",
        },
      ],
      cash: 125402,
    },
    {
      name: "Lana Edge",
      id: "cnTobUDy6",
      cars: [
        {
          name: "F250",
          year: 2020,
          price: 198500,
          carNumber: "Xxcy_",
          ownerId: "cnTobUDy6",
        },
        {
          name: "Hilux",
          year: 2005,
          price: 35005,
          carNumber: "VSCUj",
          ownerId: "cnTobUDy6",
        },
      ],
      cash: 7000,
    },
    {
      name: "Nikita Philip",
      id: "5x2tMcX4R",
      cars: [
        {
          name: "Impala",
          year: 2016,
          price: 65042,
          carNumber: "LKInp",
          ownerId: "5x2tMcX4R",
        },
      ],
      cash: 40541,
    },
    {
      name: "Bob Steel",
      id: "Wm6BkA1F0",
      cars: [],
      cash: 15732,
    },
    {
      name: "Will Reyes",
      id: "FQvNsEwLZ",
      cars: [
        { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
        {
          name: "Land Cruiser",
          year: 2020,
          price: 336300,
          carNumber: "vaJvd",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Romeo Julia",
          year: 2020,
          price: 275406,
          carNumber: "qLoYR",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Explorer",
          year: 2020,
          price: 265200,
          carNumber: "tlGRq",
          ownerId: "FQvNsEwLZ",
        },
      ],
      cash: 1547242,
    },
  ],
  taxesAuthority: {
    totalTaxesPaid: 0,
    sumOfAllTransactions: 0,
    numberOfTransactions: 0,
  },
};

//------------------------MY CODE---------------------------

//****AGENCY OPERATIONS****

//Returns agency when given ID, if it doesnt exist it returns undefined
function getAgencyByID(agencyId) {
  const agency = carMarket.sellers.find((agency) => {
    return agency.agencyId === agencyId;
  });

  console.log(`Successfully found agency by id ${agencyId}`, agency);

  return agency;
}

getAgencyByID("Plyq5M5AZ");

//Returns agency when given a name
function getAgencyByName(agencyName) {
  const agency = carMarket.sellers.find((agency) => {
    return agency.agencyName === agencyName;
  });

  console.log(`Successfully found agency by name ${agencyName}`, agency);

  return agency
}

getAgencyByName("CarMax");

//returns an array of all agency names
function getAllAgencyNames() {
  return (arrayOfNames = carMarket.sellers.map((agency) => {
    return agency.agencyName;
  }));
}

console.log("getAllAgencyNames()", getAllAgencyNames());

//adds new car to an agency.
function addNewCarToAgency(
  agencyId,
  brandName,
  carName,
  carYear,
  carPrice,
  carNumber
) {
  const agency = getAgencyByID(agencyId);

  //checks if agency exists
  if (agency) {
    if (carName && carYear && carPrice && carNumber) {
      //creates a car object using the given values
      const carObj = {
        name: carName.toString(),
        year: parseInt(carYear),
        price: parseFloat(carPrice),
        carNumber: carNumber.toString(),
        ownerId: agencyId,
      };

      //searches if the car brand exists inside the cars array of the agency and saves it in carBrand
      const carBrand = agency.cars.find((car) => {
        return car.brand.toLowerCase() === brandName.toLowerCase();
      });

      //if the carBrand exists, it pushes the new car object inside the models array
      if (carBrand != undefined) {
        carBrand.models.push(carObj);
      } else {
        //else: it creates a new brand model inside cars[] and saves the new carObj inside a models array
        agency.cars.push({
          brand: brandName,
          models: [carObj],
        });
      }
      console.log(
        `Car with num:${carObj.name} added successfully to agency#${agencyId} `
      );
    } else {
      console.log(
        `Error: failed to create car because one or more values were passed incorrectly`
      );
    }
  } else {
    console.log(
      `Error: the provided agency id (${agencyId}) does not exist in the database`
    );
  }
}

addNewCarToAgency("Plsyq5M5AZ", "Rolls-Royce", "Ghost", 2023, 398500, "837SG");
addNewCarToAgency("Plyq5M5AZ", "Rolls-Royce", "Ghost", 2023, 398500, "HsA2WG");
addNewCarToAgency("Plyq5M5AZ", "Rolls-Royce", "Phantom", 2022, 457750, "837SG");
addNewCarToAgency("Plyq5M5AZ", "Tesla", "Model S", 2023, 71090, "MU5K23");
addNewCarToAgency("Plyq5M5AZ", "bM2w");

//Removes car from agency if car exists
function removeCarFromAgency(agencyId, carNumber) {
  const agency = getAgencyByID(agencyId);

  //checks if agency actually exists
  if (agency) {
    let car = undefined;
    //looks inside each carbrand object for a car model with number === carNumber
    agency.cars.find((carBrand) => {
      //looks for the car itself inside the models array
      car = carBrand.models.find((model) => {
        return model.carNumber === carNumber;
      });
      //if the car exists it removes it from the models array using splice
      if (car) {
        carBrand.models.splice(carBrand.models.indexOf(car), 1);
        //if the models array for that brand is now empty it removes this brand object from the agency's cars array
        if (carBrand.models.length === 0) {
          agency.cars.splice(agency.cars.indexOf(carBrand), 1);
        }
        console.log(
          `car with num:${carNumber} has been successfully removed from agency#${agencyId}`
        );
        return true; //this return true is used here to stop the .find() method from running once it has found the car
      }
    });
    if (!car) {
      console.log(`No car exists with numer:${carNumber}`);
    }
  } else {
    console.log(
      `Error: the provided agency id (${agencyId}) does not exist in the database`
    );
  }
}

removeCarFromAgency("Plyq5M5AZ", "837SG");

//changes the cash of an agency
function changeAgencyCash(agencyId, cashAmount) {
  const agency = getAgencyByID(agencyId);

  cashAmount = parseFloat(cashAmount);

  if (agency) {
    if (isNaN(cashAmount)) {
      console.log(`${cashAmount} is not a number`);
    } else {
      agency.cash = cashAmount;
      console.log(
        `Cash successfully changed to ${cashAmount} for agency with id:${agencyId}`
      );
    }
  } else {
    console.log(
      `Error: the provided agency id (${agencyId}) does not exist in the database`
    );
  }
}
changeAgencyCash("Plyq5M5AZ", 300000);

//changes the credit of an agency
function changeAgencyCredit(agencyId, creditAmount) {
  const agency = getAgencyByID(agencyId);

  creditAmount = parseFloat(creditAmount);

  if (agency) {
    if (isNaN(creditAmount)) {
      console.log(`${creditAmount} is not a number`);
    } else {
      agency.credit = creditAmount;
      console.log(
        `credit successfully changed to ${creditAmount} for agency with id:${agencyId}`
      );
    }
  } else {
    console.log(
      `Error: the provided agency id (${agencyId}) does not exist in the database`
    );
  }
}
changeAgencyCash("Plyq5M5AZ", 240000);

//updates the price of a specific car in an agency
function updateCarPrice(agencyId, carNumber, newPrice) {
  const agency = getAgencyByID(agencyId);

  newPrice = parseFloat(newPrice);

  if (agency) {
    if (!isNaN(newPrice)) {
      agency.cars.find((carBrand) => {
        let carModel = carBrand.models.find((model) => {
          return model.carNumber === carNumber;
        });

        if (carModel) {
          carModel.price = newPrice;
          console.log(
            `Car price successfully changed to ${carModel.price} for car with num=${carModel.carNumber}`
          );
          return true;
        }
      });
    } else {
      console.log(`Error: newPrice must be a number`);
    }
  } else {
    console.log(
      `Error: the provided agency id (${agencyId}) does not exist in the database`
    );
  }
}
updateCarPrice("Plyq5M5AZ", "AZJZ4", 127000);

// calculates the total market revenue of the agency (sum of all car prices)
function getTotalAgencyRevenue(agencyId) {
  const agency = getAgencyByID(agencyId);

  if (agency) {
    let totalRevenue = 0;

    //loops over each car inside agency.cars
    for (const car of agency.cars) {
      //loops over model inside car.models array
      for (const model of car.models) {
        //adds the model's price to the total revenue
        totalRevenue += model.price;
      }
    }

    console.log(`Total Revenue for Agency#${agencyId} = ${totalRevenue}`);
    return totalRevenue;
  } else {
    console.log(
      `Error: the provided agency id (${agencyId}) does not exist in the database`
    );
    return undefined;
  }
}

getTotalAgencyRevenue("Plyq5M5AZ");

// transfers a car from one agency to another
function transferCarBetweenAgencies(oldAgencyId, newAgencyId, carNumber) {
  const oldAgency = getAgencyByID(oldAgencyId);
  const newAgency = getAgencyByID(newAgencyId);

  if (newAgency && oldAgency) {
    let carObj;
    let carBrand;

    for (car of oldAgency.cars) {
      for (model of car.models) {
        if (carNumber === model.carNumber) {
          carObj = model;
          carBrand = car.brand;
          console.log(carObj, carBrand);
        }
      }
    }

    if (carBrand && carObj) {
      removeCarFromAgency(oldAgencyId, carNumber);
      addNewCarToAgency(
        newAgencyId,
        carBrand,
        carObj.name,
        carObj.year,
        carObj.price,
        carObj.carNumber
      );
      console.log(
        `Car ${carNumber} has successfully been transfered from agency#${oldAgencyId} to agency#${newAgencyId}`
      );
    } else {
      console.log(
        `Transfer Failed: car#${carNumber} does not exist in agency#${oldAgencyId}'s database`
      );
    }
  } else {
    console.log(`Transfer Failed`);
  }
}
transferCarBetweenAgencies("Plyq5M5AZ", "26_IPfHU1", "MU5K23");
transferCarBetweenAgencies("Plyq5M5AZ", "26_IPfHU1", "MU5K2");

//*** CUSTOMER OPPERATIONS***//

//returns customer as an object, takes customer name as an argument
function getCustomerByName(customerName) {
  const customerObj = carMarket.customers.find((customer) => {
    return customer.name === customerName;
  });

  if (customerObj) {
    console.log(
      `Successfully found customer using name ${customerName}`,
      customerObj
    );
  } else {
    console.log(`Failed to find customer named ${customerName}`);
  }

  return customerObj;
}
getCustomerByName("Bob Steel");
getCustomerByName("Simon Asmar");

//returns customer using customerID
function getCustomerByID(customerId) {
  const customerObj = carMarket.customers.find((customer) => {
    return customer.id === customerId;
  });

  if (customerObj) {
    console.log(
      `Successfully found customer using id ${customerId}`,
      customerObj
    );
  } else {
    console.log(`Failed to find customer with id ${customerId}`);
  }

  return customerObj;
}
getCustomerByID("Wm6BkA1F0");
getCustomerByID("Wm6BkA1");

//returns all customer names
function getAllCustomerNames() {
  const customerNames = carMarket.customers.map((customer) => {
    return customer.name;
  });

  console.log("Customer Names", customerNames);

  return customerNames;
}
getAllCustomerNames();

//changes the amount of cash a customer has
function updateCustomerCash(customerId, newCashAmount) {
  const customer = getCustomerByID(customerId);

  newCashAmount = parseFloat(newCashAmount);

  if (customer && !isNaN(newCashAmount)) {
    customer.cash = newCashAmount;

    console.log(`Successfully updated cash abount for customer`, customer);
  } else {
    console.log(`Failed to update customer cash`);
  }
}
updateCustomerCash("2RprZ1dbL", 27000);

//calculates totaal value of all cars owned by customer
function getCustomerTotalCarValue(customerId) {
  const customer = getCustomerByID(customerId);

  if (customer) {
    const initialValue = 0;
    let totalCarValue = customer.cars.reduce((acc, currentValue) => {
      return acc + currentValue.price;
    }, initialValue);

    console.log(`${customer.name}\'s total car value = $${totalCarValue}`);

    return totalCarValue;
  } else {
    console.log(`Failed to get total car value`);
  }
}
getCustomerTotalCarValue("2RprZ1dbL");
getCustomerTotalCarValue("Wm6BkA1F0");

//***CAR OPERATIONS***/

//returns an array of all car models available for purchase
function getAllAvailableCars() {
  let arrayOfAllCars = [];

  carMarket.sellers.forEach((seller) => {
    seller.cars.forEach((carBrand) => {
      arrayOfAllCars = arrayOfAllCars.concat(carBrand.models);
    });
  });

  console.log("All cars available for sale:", arrayOfAllCars);
  return arrayOfAllCars;
}
getAllAvailableCars();

//returns an array of cars made in specific year
function getAvailableCarsByYear(year) {
  year = parseInt(year);

  const arrayOfCars = getAllAvailableCars().filter((car) => {
    return car.year === year;
  });

  if (arrayOfCars.length > 0) {
    console.log(
      `Found ${arrayOfCars.length} cars made in year ${year}`,
      arrayOfCars
    );
  } else {
    console.log(`Couldn\'t find any cars made in year ${year}`);
  }
  return arrayOfCars;
}
getAvailableCarsByYear(2005);
getAvailableCarsByYear(2066);

//returns an array of available cars that are within a price range
function getCarsWithinRange(minPrice, maxPrice) {
  minPrice = parseFloat(minPrice);
  maxPrice = parseFloat(maxPrice);

  if (isNaN(minPrice) || isNaN(maxPrice)) {
    console.log(`please enter a number for min and max price values`);
  } else {
    const arrayOfCars = getAllAvailableCars().filter((car) => {
      if (car.price >= minPrice && car.price <= maxPrice) {
        return true;
      }
    });

    if (arrayOfCars.length > 0) {
      console.log(
        `found ${arrayOfCars.length} cars within price range (${minPrice}, ${maxPrice})`,
        arrayOfCars
      );
    } else {
      console.log(`No cars available within given range`);
    }

    return arrayOfCars;
  }
}
getCarsWithinRange(0, 10000);

/*TO IMPLEMENT LATER
get cars based on brand
*/

//returns most expensive car available
function getMostExpensiveCar() {
  const mostExpensiveCar = getAllAvailableCars().reduce((acc, currentValue) => {
    if (acc.price > currentValue.price) {
      return acc;
    } else {
      return currentValue;
    }
  }, 0);

  console.log(
    `The most expensive car available costs $${mostExpensiveCar.price}`,
    mostExpensiveCar
  );
  return mostExpensiveCar;
}
getMostExpensiveCar();

// returns cheapest car available
function getCheapestCar() {
  const cheapestCar = getAllAvailableCars().reduce((acc, currentValue) => {
    if (acc.price < currentValue.price) {
      return acc;
    } else {
      return currentValue;
    }
  }, 0);

  console.log(
    `The cheapest available car costs $${cheapestCar.price}`,
    cheapestCar
  );
  return cheapestCar;
}
getCheapestCar();

//searches for a car with a specific number
function getAvailableCarByNumber(carNumber) {
  const carObj = getAllAvailableCars().find((car) => {
    return car.carNumber === carNumber;
  });

  if (carObj) {
    console.log(
      `Successfully found car with license plate number = ${carObj.carNumber}`,
      carObj
    );
    return carObj;
  } else {
    console.log(`Failed to find a car with license plate number ${carNumber}`);
  }
}

//***CAR PURCHASE OPERATIONS***//
function sellCar(carNumber, customerId) {
  const car = getAvailableCarByNumber(carNumber);
  const customer = getCustomerByID(customerId);

  if (car && customer) {
    const agency = getAgencyByID(car.ownerId);

    if (agency) {

      //i wrote it this way because i think if customer doesn't have enough cash they can buy on credit (loan from the company if the company has enough credit)?
      if (customer.cash >= car.price - agency.credit) {
        const taxPrice = parseFloat((car.price * 0.17).toFixed(2));

        //purchasable without credit
        if (customer.cash >= car.price) {
          changeAgencyCash(agency.agencyId, (agency.cash + car.price - taxPrice));
          updateCustomerCash(customer.id, customer.cash - car.price);
        } else {
          //needs credit (NOT SURE IF THIS IS HOW IT SHOULD BE IMPLEMENTED)
          changeAgencyCash(agency.agencyId, (agency.cash + customer.cash - taxPrice));
          updateCustomerCash(customer.id, customer.cash - car.price);
          //since customer cash is in the negatives we add it to company credit
          changeAgencyCredit(agency.agencyId, agency.credit + customer.cash);
        }

        removeCarFromAgency(agency.agencyId, car.carNumber);
        customer.cars.push(car);

        console.log(
          `${customer.name} successfully bought car with num ${car.carNumber} for $${car.price}. ${customer.name}\'s cash balance = ${customer.cash}. Agency cash=${agency.cash},credit=${agency.credit}`
        );

        //update TAX Authority records
        carMarket.taxesAuthority.numberOfTransactions++;
        carMarket.taxesAuthority.sumOfAllTransactions+=car.price;
        carMarket.taxesAuthority.totalTaxesPaid = (parseFloat(carMarket.taxesAuthority.totalTaxesPaid) + taxPrice).toString();
        
      } else {
        console.log(
          `Failed to sell car: customer cannot affor car! car price: ${car.price}, customer cash: ${customer.cash}, agency credit: ${agency.credit}`
        );
      }
    } else {
      console.log(`Failed to sell car: couldn't find agency`);
    }
  } else {
    if (!car) {
      console.log(
        `Failed to sell car: couldn't find available car with number (${carNumber})`
      );
    } else if (!customer) {
      console.log(
        `Failed to sell car: couldn't find customer with id (${customerId})`
      );
    }
  }
}
// sellCar("S6DL1", "Wm6BkA1F0");
sellCar("QwBOT", "Wm6BkA1F0");
// sellCar("KqKV_", "Wm6BkA1F0");

console.log(carMarket.taxesAuthority);

//Returns total market revenue (not sure if it should be the combined total revinue of all agencies or if it should also include customers cash)
function getTotalMarketReveue(){
    const totalMarketRevenue = carMarket.sellers.reduce((acc, currentSeller) => {
        return acc + getTotalAgencyRevenue(currentSeller.agencyId);
    }, 0)

    console.log(`Total Market Revenue = $${totalMarketRevenue}`);

    return totalMarketRevenue;
}
getTotalMarketReveue();